EOL           = '\n' | '\r\n'      ; End of line
SPACE         = ' ' | '\t'         ; One or more spaces or tabs
INDENT        = (generated by lexer when a new indentation level is detected)
DEDENT        = (generated by lexer when returning to a lesser indentation level)
AT            = '@'
DOLLAR        = '$'
SLASH         = '/'
EQUAL         = '='
DOUBLE_QUOTE  = '"'
HASH          = '#'
DASH          = '-'
GT            = '>'
BACKTICK      = '`'

Identifier    = [A-Za-z0-9_]+
Value         = ([^"\r\n])*       ; Characters up to a double quote or EOL
TextChar      = [^\r\n]+          ; Characters until end of line (excluding control chars)


---


Document := Block+
Block := HeadingBlock
       | ListBlock
       | CodeBlock
       | BlockquoteBlock
       | CommandBlock
       | ParagraphBlock

HeadingBlock := HeadingMarker InlineContent EOL

HeadingMarker := '#' | '##' | '###' | '####' | '#####' | '######'
ParagraphBlock := InlineContent EOL (InlineContent EOL)*

ListBlock := ListItem+

ListItem  := DASH SPACE InlineContent EOL (INDENT Block+ DEDENT)?

CodeBlock := '```' (Identifier)? EOL CodeContent '```' EOL

CodeContent := (TextChar EOL)*

BlockquoteBlock := GT SPACE InlineContent EOL (INDENT Block+ DEDENT)?

CommandBlock := CommandStart EOL (INDENT InnerContent+ DEDENT)?

CommandStart := SLASH CommandName Attributes? Variables?

CommandName := Identifier

Attributes := Attribute+
Attribute  := AT Identifier EQUAL DOUBLE_QUOTE Value DOUBLE_QUOTE

Variables  := Variable+
Variable   := DOLLAR Identifier

InnerContent := Block
              | InlineContent EOL


InlineContent := (InlineElement)+

InlineElement := InlineText
               | InlineEmphasis
               | InlineStrong
               | InlineCode
               | InlineVariable

InlineText := TextRun
TextRun := [^*`$]+  ; text not starting with special inline chars